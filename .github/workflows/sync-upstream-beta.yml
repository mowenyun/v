name: Upstream Sync Beta

permissions:
  contents: write

on:
  schedule:
    - cron: '0 6 * * *'  # 每天 UTC 6:00（CDT 凌晨 1 点）
  workflow_dispatch:

jobs:
  sync_latest_from_upstream:
    name: Sync latest commits from upstream beta repo
    runs-on: ubuntu-latest
    if: ${{ github.event.repository.fork }}

    steps:
      # Step 1: run a standard checkout action
      - name: Checkout target repo
        uses: actions/checkout@v4  # 更新到 v4 以兼容最新

      # Step 2: run the sync action
      - name: Sync upstream changes
        id: sync
        uses: aormsby/Fork-Sync-With-Upstream-action@v3.4
        with:
          upstream_sync_repo: cmliu/edgetunnel  # 上游仓库（替换为 edgetunnel 如果是 VLESS 项目）
          upstream_sync_branch: beta  # 上游 beta 分支
          target_sync_branch: beta  # 你的 fork beta 分支
          target_repo_token: ${{ secrets.GITHUB_TOKEN }}  # 自动生成，无需设置

          # Set test_mode true to run tests instead of the true action!!
          test_mode: false

      - name: Sync check
        if: failure()
        run: |
          echo "[Error] 由于上游仓库的 workflow 文件变更，导致 GitHub 自动暂停了本次自动更新，你需要手动 Sync Fork 一次，详细教程请查看项目README.md "
          echo "[Error] Due to a change in the workflow file of the upstream repository, GitHub has automatically suspended the scheduled automatic update. You need to manually sync your fork. Please refer to the project README.md for instructions. "
          exit 1